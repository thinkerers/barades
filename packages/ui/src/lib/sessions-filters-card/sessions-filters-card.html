<section class="filters-card mat-elevation-z8">
  <header class="filters-card__header">
    <div class="filters-card__title">
      <mat-icon aria-hidden="true">filter_alt</mat-icon>
      <h3>Filtres</h3>
      @if (hasActiveFilters) {
      <span class="filters-card__badge">{{ activeFiltersCount }}</span>
      }
    </div>
    <button
      mat-button
      type="button"
      class="filters-card__reset"
      (click)="resetFilters.emit()"
      [disabled]="!hasActiveFilters"
    >
      <mat-icon aria-hidden="true">refresh</mat-icon>
      Réinitialiser
    </button>
  </header>

  <div class="filters-card__grid">
    <lib-search-filter-field
      class="filters-card__field"
      [searchTerm]="searchTerm"
      (searchTermChange)="searchTermChange.emit($event)"
    ></lib-search-filter-field>

    <lib-host-filter-field
      class="filters-card__field filters-card__field--host"
      [selectedHost]="selectedHost"
      [filteredHostOptions]="filteredHostOptions"
      [isScopeFilterActive]="isScopeFilterActive"
      (hostFilterChange)="hostFilterChange.emit($event)"
      (hostFilterFocus)="hostFilterFocus.emit()"
      (clearHostFilter)="clearHostFilter.emit()"
      (hostOptionSelected)="hostOptionSelected.emit($event)"
    ></lib-host-filter-field>

    <div class="filters-card__field filters-card__field--session-type">
      <span class="filters-card__label">Type de session</span>
      <div
        class="filters-card__toggles"
        role="group"
        aria-label="Filtrer par type de session"
      >
        <button
          type="button"
          class="filter-toggle"
          [class.filter-toggle--active]="sessionType === 'all'"
          (click)="sessionTypeChange.emit('all')"
        >
          <mat-icon aria-hidden="true">dashboard</mat-icon>
          <span>Toutes</span>
        </button>
        <button
          type="button"
          class="filter-toggle"
          [class.filter-toggle--active]="sessionType === 'online'"
          (click)="sessionTypeChange.emit('online')"
        >
          <mat-icon aria-hidden="true">computer</mat-icon>
          <span>En ligne</span>
        </button>
        <button
          type="button"
          class="filter-toggle"
          [class.filter-toggle--active]="sessionType === 'onsite'"
          (click)="sessionTypeChange.emit('onsite')"
        >
          <mat-icon aria-hidden="true">groups</mat-icon>
          <span>Sur table</span>
        </button>
      </div>
    </div>

    <div class="filters-card__field filters-card__field--game">
      <lib-game-system-input
        [ngModel]="selectedGameSystem"
        (ngModelChange)="gameFilterChange.emit($event)"
        [gameSystems]="gameSystems"
        [maxSuggestions]="maxGameSuggestions"
        [minSuggestionLength]="minGameSuggestionLength"
        [suggestionThreshold]="gameSuggestionThreshold"
        [clearButtonAriaLabel]="'Effacer le filtre système de jeu'"
      ></lib-game-system-input>
    </div>
  </div>

  <div class="filters-card__availability">
    <div class="filters-card__availability-card">
      <mat-checkbox
        [ngModel]="onlyAvailable"
        (ngModelChange)="availabilityChange.emit($event)"
      >
        Uniquement les sessions avec places disponibles
      </mat-checkbox>
    </div>
  </div>
</section>
