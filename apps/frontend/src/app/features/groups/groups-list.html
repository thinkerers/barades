<div class="groups-container">
  <header class="groups-header">
    <h1>Groupes de jeu</h1>
    <p>Rejoignez une communauté de joueurs passionnés</p>
  </header>

  @if (isOffline) {
  <div class="offline-banner" role="status">
    <span class="offline-banner__icon" aria-hidden="true">!</span>
    <div class="offline-banner__content">
      <strong>Erreur de connexion.</strong>
      <span>Vérifiez votre réseau puis réessayez.</span>
    </div>
    <button type="button" class="offline-banner__retry" (click)="retry()">
      Réessayer
    </button>
  </div>
  }

  <lib-async-state
    [status]="groupsState"
    [loadingMessage]="'Chargement des groupes...'"
    [errorMessage]="error ?? defaultErrorMessage"
    [showRetry]="!isOffline"
    (retry)="retry()"
  >
    <div class="groups-list">
      <!-- Empty State -->
      @if (groups.length === 0) {
      <div class="empty-state">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="64"
          height="64"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
        >
          <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
          <circle cx="9" cy="7" r="4"></circle>
          <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
          <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
        </svg>
        <h3>Aucun groupe disponible</h3>
        <p>Soyez le premier à créer un groupe !</p>
      </div>
      }

      <!-- Groups Grid -->
      @if (groups.length > 0) {
      <div class="groups-grid">
        @for (group of groups; track group) {
        <lib-group-card
          [group]="group"
          [secondaryActionLabel]="hasJoined(group.id) ? 'Rejoint' : 'Rejoindre'"
          [secondaryActionDisabled]="hasJoined(group.id)"
          [secondaryActionLoading]="isJoining(group.id)"
          (primaryAction)="viewGroupDetails(group.id)"
          (secondaryAction)="requestToJoin(group)"
        ></lib-group-card>
        @if (isRecentlyJoined(group.id)) {
        <p class="group-feedback group-feedback--success">
          Vous avez rejoint ce groupe.
        </p>
        } @if (getJoinError(group.id)) {
        <p class="group-feedback group-feedback--error">
          {{ getJoinError(group.id) }}
        </p>
        } }
      </div>
      }
    </div>
  </lib-async-state>
</div>
