<div class="sessions-page">
  <header class="sessions-page__header">
    <h1 class="sessions-page__title">{{ pageTitle() }}</h1>
    <p class="sessions-page__subtitle">{{ pageSubtitle() }}</p>

    @if (isScopeFilterActive()) {
    <lib-sessions-scope-banner
      #scopeBanner
      [message]="scopeBannerMessage()"
      [showBackAction]="comingFromDashboard()"
      (backAction)="returnToDashboard()"
      (clearAction)="clearScopeFilter()"
    ></lib-sessions-scope-banner>
    }
  </header>

  <lib-async-state
    [status]="sessionsState()"
    [loadingMessage]="'Chargement des sessions...'"
    [errorMessage]="error() ?? defaultErrorMessage"
    (retry)="loadSessions()"
  >
    <lib-sessions-filters-card
      [activeFiltersCount]="activeFiltersCount()"
      [searchTerm]="searchTerm()"
      (searchTermChange)="onSearchTermChange($event)"
      [selectedHost]="selectedHost()"
      [filteredHostOptions]="filteredHostOptions()"
      [isScopeFilterActive]="isScopeFilterActive()"
      (hostFilterChange)="onHostFilterChange($event)"
      (hostFilterFocus)="onHostFilterFocus()"
      (clearHostFilter)="clearHostFilter()"
      (hostOptionSelected)="onHostOptionSelected($event)"
      [sessionType]="sessionType()"
      (sessionTypeChange)="onSessionTypeChange($event)"
      [selectedGameSystem]="selectedGameSystem()"
      (gameFilterChange)="onGameFilterChange($event)"
      [gameSystems]="gameSystems()"
      [maxGameSuggestions]="maxGameSuggestions"
      [minGameSuggestionLength]="minGameSuggestionLength"
      [gameSuggestionThreshold]="gameSuggestionThreshold"
      [onlyAvailable]="onlyAvailable()"
      (availabilityChange)="onAvailabilityChange($event)"
      (resetFilters)="resetFilters()"
    ></lib-sessions-filters-card>

    <div class="sessions-list">
      @if (refreshing()) {
      <div class="sessions-list__refresh" role="status" aria-live="polite">
        Mise à jour des sessions...
      </div>
      }

      <div class="sessions-list__header">
        <h2>
          {{ isScopeFilterActive() ? 'Mes sessions' : 'Sessions disponibles' }}
          <span class="count"
            >({{ filteredSessions().length }} / {{ sessions().length }})</span
          >
        </h2>
      </div>

      @if (filteredSessions().length === 0) {
      <lib-empty-state
        message="Aucune session ne correspond à vos critères de recherche."
        actionLabel="Réinitialiser les filtres"
        (action)="resetFilters()"
      ></lib-empty-state>
      }

      <div class="sessions-list__cards">
        @for (session of filteredSessions(); track session) {
        <app-session-card [session]="session"></app-session-card>
        }
      </div>
    </div>
  </lib-async-state>
</div>
