<div class="locations-container">
  <header class="locations-header">
    <h1>Lieux de jeu</h1>
    <p>D√©couvrez les lieux o√π se d√©roulent les sessions</p>
  </header>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-container">
    <div class="spinner"></div>
    <p>Chargement des lieux...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error && !loading" class="error-container">
    <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <circle cx="12" cy="12" r="10"></circle>
      <line x1="12" y1="8" x2="12" y2="12"></line>
      <line x1="12" y1="16" x2="12.01" y2="16"></line>
    </svg>
    <p>{{ error }}</p>
    <button (click)="retry()" class="retry-button">R√©essayer</button>
  </div>

  <!-- Map and List - Always rendered but hidden during loading -->
  <div class="content-wrapper" [class.hidden]="loading || error">
    <!-- Filters Panel -->
    <div class="filters-panel">
      <h3>üîç Filtres</h3>
      
      <!-- Search Bar -->
      <div class="filter-group">
        <label for="search">Recherche</label>
        <input 
          type="text" 
          id="search" 
          [(ngModel)]="searchTerm" 
          (input)="applyFilters()"
          placeholder="Nom, adresse, ville..."
          class="search-input"
        />
      </div>

      <!-- Location Type Filter -->
      <div class="filter-group">
        <label for="type-filter">Type de lieu</label>
        <select 
          id="type-filter" 
          [(ngModel)]="selectedType" 
          (change)="applyFilters()"
          class="type-select"
        >
          <option value="">Tous les types</option>
          <option value="GAME_STORE">Boutique de jeux</option>
          <option value="CAFE">Caf√©</option>
          <option value="BAR">Bar</option>
          <option value="COMMUNITY_CENTER">Centre communautaire</option>
          <option value="OTHER">Autre</option>
        </select>
      </div>

      <!-- Amenities Filter -->
      <div class="filter-group">
        <div class="filter-label">√âquipements</div>
        <div class="amenities-checkboxes">
          <label class="checkbox-label">
            <input 
              type="checkbox" 
              [(ngModel)]="filters.wifi" 
              (change)="applyFilters()"
            />
            <span>üì∂ WiFi</span>
          </label>
          <label class="checkbox-label">
            <input 
              type="checkbox" 
              [(ngModel)]="filters.tables" 
              (change)="applyFilters()"
            />
            <span>ü™ë Tables de jeu</span>
          </label>
          <label class="checkbox-label">
            <input 
              type="checkbox" 
              [(ngModel)]="filters.food" 
              (change)="applyFilters()"
            />
            <span>üçî Nourriture</span>
          </label>
          <label class="checkbox-label">
            <input 
              type="checkbox" 
              [(ngModel)]="filters.drinks" 
              (change)="applyFilters()"
            />
            <span>‚òï Boissons</span>
          </label>
          <label class="checkbox-label">
            <input 
              type="checkbox" 
              [(ngModel)]="filters.parking" 
              (change)="applyFilters()"
            />
            <span>üÖøÔ∏è Parking</span>
          </label>
        </div>
      </div>

      <!-- Reset Filters Button -->
      <button (click)="resetFilters()" class="reset-button">
        üîÑ R√©initialiser les filtres
      </button>
    </div>

    <!-- Map Container -->
    <div class="map-container">
      <button 
        type="button"
        class="geolocation-button"
        (click)="getUserLocation()"
        [disabled]="geolocating"
        [title]="geolocationError || 'Trouver ma position'"
      >
        <svg *ngIf="!geolocating" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"></circle>
          <circle cx="12" cy="12" r="3"></circle>
          <line x1="12" y1="1" x2="12" y2="3"></line>
          <line x1="12" y1="21" x2="12" y2="23"></line>
          <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
          <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
          <line x1="1" y1="12" x2="3" y2="12"></line>
          <line x1="21" y1="12" x2="23" y2="12"></line>
          <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
          <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
        </svg>
        <span *ngIf="geolocating" class="spinner"></span>
        <span>{{ geolocating ? 'Localisation...' : 'Ma position' }}</span>
      </button>
      
      <div *ngIf="geolocationError" class="geolocation-error">
        {{ geolocationError }}
      </div>
      
      <div id="map" class="map"></div>
    </div>

    <!-- Locations List -->
    <div class="locations-list">
      <h2>Liste des lieux ({{ filteredLocations.length }} / {{ locations.length }})</h2>
      
      <div class="location-cards">
        <div 
          *ngFor="let location of filteredLocations" 
          [id]="'location-' + location.id"
          class="location-card"
          [class.selected]="selectedLocationId === location.id"
          (click)="onLocationClick(location.id)"
          role="button"
          tabindex="0"
          (keydown.enter)="onLocationClick(location.id)"
          (keydown.space)="onLocationClick(location.id)"
        >
          <div class="location-header">
            <h3>{{ location.name }}</h3>
            <span class="location-type">{{ getLocationTypeLabel(location.type) }}</span>
          </div>

          <div class="location-info">
            <div class="info-row" *ngIf="location.address">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                <circle cx="12" cy="10" r="3"></circle>
              </svg>
              <span>{{ location.address }}, {{ location.city }}</span>
            </div>

            <div class="info-row" *ngIf="location.city && !location.address">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                <circle cx="12" cy="10" r="3"></circle>
              </svg>
              <span>{{ location.city }}</span>
            </div>

            <div class="info-row">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
              </svg>
              <span>{{ location.rating.toFixed(1) }}/5</span>
            </div>

            <div class="info-row" *ngIf="location.capacity">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                <circle cx="9" cy="7" r="4"></circle>
                <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
              </svg>
              <span>Capacit√©: {{ location.capacity }} personnes</span>
            </div>
          </div>

          <div class="amenities" *ngIf="location.amenities.length > 0">
            <span *ngFor="let amenity of location.amenities" class="amenity-tag">{{ amenity }}</span>
          </div>

          <div class="location-actions">
            <a *ngIf="location.website" [href]="location.website" target="_blank" rel="noopener" class="website-button">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="2" y1="12" x2="22" y2="12"></line>
                <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path>
              </svg>
              Site web
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
